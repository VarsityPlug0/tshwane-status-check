<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Application Results / Status</title>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <meta http-equiv="Expires" content="-1">
    <link rel="stylesheet" type="text/css" href="/itsincludes/css/itscustom.css">
    <script src="/itsincludes/js/its_scripts.js"></script>
    <script src="/itsincludes/js/overlib.js"></script>
    <meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE">
    <style>
        body {
            background-image: url('/itsimages/TUT10year.jpg');
            background-repeat: no-repeat;
            background-position: left top;
            background-size: 100% 180px;
            font-family: Arial, sans-serif;
        }

        #alignInMiddle {
            margin-left: auto;
            margin-right: auto;
            margin-top: 180px;
            width: 80%;
            background-color: #ECE9D8;
            position: relative;
            border: 1px solid black;
            padding-bottom: 20px;
        }

        .calendar-icon {
            font-size: 18px;
            cursor: pointer;
            color: blue;
        }

        /* Student Details Box */
        .mi_userdet {
            border: 1px solid #999;
            background-color: #E2E2E2;
            /* Light gray background */
            width: auto;
            margin-bottom: 20px;
            border-collapse: collapse;
        }

        .mi_userdet td {
            font-size: 12px;
            padding: 3px 5px;
            border: 0;
        }

        /* Results Table */
        .rltable {
            width: 100%;
            border-collapse: collapse;
        }

        .rltable td,
        .rltable th {
            font-size: 11px;
            /* Slightly smaller to match compact look */
            padding: 4px;
            border: 0px solid #ddd;
            text-align: left;
            vertical-align: top;
        }

        .rlheader {
            background-color: #E2E2E2;
            font-weight: bold;
        }

        h3 {
            font-size: 14px;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
        }
    </style>
</head>

<body class="framebody" topmargin="0" leftmargin="0" marginwidth="0" marginheight="0">
    <div id="overDiv" style="position:absolute; visibility:hidden; z-index:1000;"></div>
    <div id="alignInMiddle">
        <div id="listedDiv" style="padding: 10px;">
            <h3>Application Results / Status</h3>
            <table id="mi_userdet" class="mi_userdet" cellspacing="0" cellpadding="0">
                <tbody>
                    <tr>
                        <td align="left" id="studentDetailsCell">
                            <!-- Content will be populated by JavaScript -->
                        </td>
                    </tr>
                </tbody>
            </table>
            <br><br>
            <table class="rltable" cellspacing="0" cellpadding="2">
                <tbody id="resultsBody">
                    <tr class="rlheader">
                        <td class="datahdl">Year</td>
                        <td class="datahdl">Qualification</td>
                        <td class="datahdl">Faculty</td>
                        <td class="datahdl">Status</td>
                        <td class="datahdl">Academic<br>Choice</td>
                        <td class="datahdl">Application<br>Letter</td>
                    </tr>
                    <!-- Rows will be populated by JavaScript -->
                </tbody>
            </table>
            <br><br>
        </div>
    </div>
    <script>
        // Check if user is logged in
        const currentUserJSON = localStorage.getItem('currentUser');
        if (!currentUserJSON) {
            // If no user found, redirect to login
            window.location.href = 'index.html';
        } else {
            const user = JSON.parse(currentUserJSON);

            // Populate Student Details
            const detailsHtml = `
                <b>Student Number:</b> ${user.sno}<br>
                <b>ID Number:</b> ${user.id}<br>
                <b>Name:</b> ${user.name}<br>
            `;
            document.getElementById('studentDetailsCell').innerHTML = detailsHtml;

            // Populate Results Table
            const resultsBody = document.getElementById('resultsBody');

            // Keep the header row
            // Note: Since I didn't clear innerHTML but appended to it in my thought process, 
            // actually here I am replacing the whole body content in the HTML, so I need to make sure 
            // the header is present in the HTML above, which it is.
            // Wait, if I append to resultsBody, I need to make sure I don't delete the header if it's inside the tbody.
            // In the HTML above, the header IS inside the tbody.
            // So appending to resultsBody is fine as long as I don't clear it first.

            user.courses.forEach(course => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${course.year}</td>
                    <td>${course.code}</td>
                    <td>${course.faculty}</td>
                    <td>${course.status}</td>
                    <td>${course.choice}</td>
                    <td><a href="">${course.date}</a></td>
                `;
                resultsBody.appendChild(tr);
            });
        }
    </script>
</body>

</html>